# iProTraX 用户手册

**版本 8.2.0**

---

## 目录

1. [简介](#简介)
2. [快速开始](#快速开始)
   - [系统要求](#系统要求)
   - [登录](#登录)
   - [注册](#注册)
3. [仪表盘概览](#仪表盘概览)
   - [导航](#导航)
   - [产品线选择](#产品线选择)
   - [订单表格](#订单表格)
4. [操作视图](#操作视图)
   - [条形码扫描](#条形码扫描)
   - [快速状态更新](#快速状态更新)
   - [智能评论](#智能评论)
   - [工步进度追踪](#工步进度追踪)
5. [批量操作](#批量操作)
   - [P 模式](#p-模式)
   - [N/A 模式](#na-模式)
   - [Hold 模式](#hold-模式)
   - [QN 模式](#qn-模式)
   - [WIP 模式](#wip-模式)
   - [完成模式](#完成模式)
   - [擦除模式](#擦除模式)
   - [超级编辑模式](#超级编辑模式)
6. [导入订单](#导入订单)
7. [AI 助手](#ai-助手)
8. [设置](#设置)
   - [产品线配置](#产品线配置)
   - [AI 设置](#ai-设置)
   - [用户管理](#用户管理)
   - [数据管理](#数据管理)
   - [API 示例查询](#api-示例查询)
11. [常见问题](#常见问题)
12. [技术支持](#技术支持)

---

## 简介

**iProTraX** 是一款 AI 驱动的生产跟踪系统，专为制造业环境设计。它可以帮助您：

- 跟踪工单在多个生产步骤中的进度
- 通过桌面或移动设备实时更新订单状态
- 使用 AI 助手分析生产数据
- 从单一界面管理多条产品线

---

## 快速开始

### 系统要求

- 现代网页浏览器（Chrome、Firefox、Safari、Edge）
- 网络连接或可访问本地服务器
- 移动端：iOS Safari 或 Android Chrome

### 登录

1. 访问 iProTraX 网址（例如：`http://localhost:3001`）
2. 输入您的 **用户名** 和 **密码**
3. 点击 **登录**

> **提示**：如果没有账户，请联系管理员或使用注册链接。

### 注册

1. 点击"没有账户？创建一个"
2. 输入您想要的用户名和密码
3. 提交表单
4. 等待管理员审批（新账户需要审批）

---

## 仪表盘概览

登录后，您将看到包含所有订单的主仪表盘。

### 导航

| 按钮 | 描述 |
|------|------|
| **首页** | 带有订单表格的主仪表盘 |
| **操作** | 为生产线工人优化的简化视图 |
| **设置** | 配置产品、用户和系统设置 |

### 产品线选择

- 点击页眉中的 **产品下拉菜单** 切换产品线
- 每条产品线都有独立的订单、步骤和配置
- **列宽调整**：您可以拖动列标题的边缘来调整宽度，系统会自动记住您的设置。

### 订单表格

主表格显示所有工单，包括：

- **详细列**：订单号、客户、交期、数量等 (默认排序：高优先级 > 警告 > 最早交期)
- **步骤列**：生产步骤（如：裁切、组装、质检）
- **状态指示**：
  - 📘 **P** = 计划中/待处理
  - ⬜ **N/A** = 不适用 (如果在最后一步标记为 N/A，则视为已完成)
  - 🟠 **Hold** = 暂停
  - 🔴 **QN** = 质量通知（问题）
  - 🟡 **WIP** = 进行中
  - ✅ **日期** = 已完成（显示完成日期）

---

---

## 操作视图

**操作视图** 针对使用平板或手机的生产线工人进行了优化。

### 条形码扫描

1. 点击 **扫描** 按钮（条形码图标）
2. 将摄像头对准工单号条形码
3. 系统将自动定位并显示该订单

### 快速状态更新

在操作视图中，您可以快速更新订单状态：

1. 找到您的订单（通过扫描或滚动）
2. 点击步骤单元格
3. 从弹出菜单中选择新状态：
   - **完成** - 标记为完成并添加时间戳
   - **WIP** - 进行中
   - **Hold** - 暂停
   - **QN** - 质量通知
   - **N/A** - 不适用

### 智能评论 (Smart Comments)

通过工单级评论连接一线操作员、主管与管理者，实现无缝协作。

1.  **点击评论图标**：附在操作视图中的任何步骤上。
2.  **添加评论**：输入您的消息。
3.  **选择类别**：标记评论以帮助 AI 分析问题。
    *   `General` (常规)：普通讨论。
    *   `QN` (质量)：质量问题、缺陷。
    *   `Material` (物料)：缺件、物料错误。
    *   `Machine` (设备)：设备故障或维护。
    *   `Hold` (暂停)：流程阻塞。
4.  **发送**：评论将记录您的用户 ID 和时间戳。

### 工步进度追踪

*（v8.1.0 新功能）*

追踪每个生产步骤的工时，计算员工效率，并实时监控生产进度。

#### 1. 我的进行中工单 (My Active Sessions)
操作视图顶部新增了"我的进行中工单"卡片，集中显示您当前正在进行的所有任务：

*   **实时计时器**：显示已工作时长 (HH:MM:SS)。
*   **标准工时 (Std)**：黄色标签显示该工序的标准定额时间（如 `Std: 1h 30m`），供操作员参考。
*   **进度条**：直观显示当前完成量与目标数量的比例。
    *   **已完成 (Completed)**：您提交的良品数量。
    *   **剩余 (Left)**：目标数量减去已完成数量。
    *   *注意：如果未在后台配置目标数量，进度条将隐藏，仅显示完成数。*
*   **快速停止 (Stop)**：卡片右侧的红色小按钮，允许您不进入详情页直接结束工作。

#### 2. 开始与结束工作
1.  **开始**：在操作视图中找到对应工序，点击 **追踪进度 (Track Progress)** 按钮。
2.  **结束**：
    *   方式一：点击"我的进行中工单"上的 **Stop** 按钮。
    *   方式二：再次点击工序上的追踪按钮进入详情页，点击 **结束工步**。
3.  **输入数量**：
    *   结束时需输入本次产出的数量。
    *   **严格校验**：系统会根据剩余目标数量进行校验，输入的数量不能超过剩余量。

#### 3. 效率与报表 (仅限主管/管理员)
*   **效率计算**：系统根据 `标准工时 / 实际工时` 计算效率。如果能在少于标准时间内完成目标，效率将 > 100%。
*   **查看报表**：点击顶部导航栏的 **报表 (Reports)** 图标 📊。
    *   *注意：普通员工无法查看报表功能。*
    *   可查看每日产出、员工效率排名、工序耗时分布等数据。

---

## 电子看板 (Kiosk Mode)

**电子看板**（Shop Floor Monitor）专门用于生产现场的显示终端（平板或大屏），提供高对比度的全屏视图。

### 访问方式
- **专用账户**：建议创建一个角色为 `kiosk` 的账户。该账户登录后会自动锁定在看板页面，无法访问后台管理界面。
- **长效登录**：Kiosk 账户的登录有效期长达 **30 天**，适合长期开启的显示终端。

### 功能特点
- **自动刷新**：每 60 秒自动更新一次生产数据。
- **控制台锁定**：安全解锁需要输入当前账户密码。

---

## 批量操作 (仅限主管/管理员)

对于主管和管理员，批量操作允许快速更新多个单元格。

### P 模式

- 点击 **P** 按钮进入 P 模式
- 点击任意步骤单元格切换"P"（计划中）状态
- 再次点击 **P** 退出

### N/A 模式

- 为跳过某些步骤的订单标记"不适用"

### Hold 模式

- 当等待材料或审批时将订单暂停

### QN 模式

- 标记需要注意的质量问题步骤

### WIP 模式

- 表示工作正在积极进行中

### 完成模式

- 点击以当前日期/时间戳标记步骤为完成

### 擦除模式

- 仅限管理员 或主管需要密码
- 清除单元格中的任何状态
- 请谨慎使用！

### 超级编辑模式

*（V6.3.0 新功能 - 仅限管理员/主管）*

- **功能**: 直接修改工单详情列（如 WO ID, PN, 描述等），无需重新导入 Excel。
- **操作**:
    1. 点击 WO ID 列左上角的 **锁图标** 🔒。
    2. 图标变为解锁状态 🔓，并且表格边框变色提示进入编辑模式。
    3. 点击任意详情单元格（WO ID, PN, Priority, Due Date 等）进行修改。
    4. 输入新内容并回车，更改即时保存。
- **限制**: **ECD** 列为系统自动计算，不可修改。
- **注意**: 修改即时生效，请谨慎操作。无需提交按钮。

---

## 日志管理

### 操作日志
系统会记录对订单所做的每一次更改。您可以通过点击仪表盘页眉中的 **历史记录 (History)** 图标来查看这些日志。

### 导出与清除（管理员/主管）
在操作日志弹窗中：
1.  **导出 CSV**: 点击绿色的 **CSV** 按钮，将完整日志下载为 Excel 可分析的表格文件。
2.  **清除日志**:（仅限管理员）点击红色的 **Clear** 按钮永久删除所有历史记录。建议在开始新的生产周期时使用。

---

## 导入订单

### Excel 导入（管理员/主管）

1. 点击页眉中的 **导入** 按钮
2. 选择您的 Excel 文件（.xlsx 或 .xls）
3. 查看导入预览
4. 点击 **导入** 添加新订单

> **注意**：现有的工单号会自动跳过，以防止重复。

---

## AI 助手

iProTraX 包含一个智能悬浮 AI 助手，可以帮助您：

- 分析生产风险和延误
- 生成每日晨会简报
- 自动跳转到特定工单
- 回答关于生产状态的问题

### 使用 AI

1. 点击 **聊天图标** 💬（屏幕右下角）
2. 输入您的问题，或使用 **快捷工具**（仅限管理员/主管）：
    - **风险分析 (Analyze Risks)**：识别可能有延误风险的订单。
    - **晨会简报 (Morning Report)**：生成每日站会总结。
    - **类别诊断 (Category Diagnosis)**：询问“最高的质量问题是什么？”以分析标记为 `QN` 的评论。

### AI 类别分析 🧠
AI 自动按类别聚合评论以提供深入见解：
*   **瓶颈检测**：“为什么装配有 5 个订单暂停？”（分析 `Hold` 评论）
*   **维护警报**：“显示最近的机器问题。”（分析 `Machine` 评论）
*   **质量趋势**：“总结上周的 QN 报告。”（分析 `QN` 评论）

### 智能跳转 (Smart Navigation) 🚀
您可以直接告诉 AI 带您去查看某个工单：
*   "打开 WO-1234"
*   "看看订单 5555"

**结果**：系统会自动为您打开该订单的 **操作视图**。

### 示例问题

- "哪些订单落后于计划？"
- "绕线步骤的平均时间是多少？"
- "显示 QN 状态的订单"
- "总结今天的生产情况"

---

## 设置

从导航栏访问设置。

### 产品线配置

*（仅限管理员）*

为各生产线配置详细参数，以启用高级追踪功能。

1.  **添加/编辑产品线**：在设置页面的"生产线配置"区域操作。
2.  **工步参数配置**：
    *   **步骤名称**：定义生产流程中的每个步骤（如：绕线、装配）。
    *   **标准工时 (Hours)**：设定该步骤的标准耗时（支持小时和分钟），用于计算员工效率。
    *   **目标数量 (Target Qty)**：设定该步骤在当前班次或订单中的目标产出量。*设置此项后，操作视图将显示进度条。*
    *   **单位 (Unit)**：产出物的计量单位（如：pcs, sets, kg）。
3.  **其他设置**：
    *   **月度目标**：设定整个生产线的月度总产出目标，用于仪表盘的统计显示。
    *   **自动导入**：配置文件夹监控路径，实现 Excel 订单自动导入。

### AI 设置

*（仅限管理员）*

配置智能助手以适应您的使用环境。

1.  **AI 模型选择**：
    *   **DeepSeek (中国)**：专为国内用户优化，访问速度快，中文理解能力强。
    *   **OpenAI (海外)**：GPT-4o / GPT-3.5，需科学上网环境。
    *   **本地模型 (Ollama)**：支持私有化部署的本地模型。
2.  **配置 DeepSeek**：
    *   选择 "DeepSeek (China)"。
    *   输入您的 API Key（可在 deepseek.com 申请）。
    *   点击 **测试连接** 确认可用性。
3.  **自定义指令**：
    *   在"产品知识库"中输入特定产品的术语、常见缺陷代码或操作规范。
    *   AI 将基于这些信息提供更专业的回答。

### 用户管理

*（管理员/主管）*

导航至 **设置 → 用户管理** 可以：

- 查看所有用户
- 审批待处理的注册
- 重置密码
- 启用/禁用账户
- 删除用户（仅限管理员）

- **清理**：删除超过 3 个月的数据

### API 密钥管理
*（仅限管理员）*

iProTraX 开放了 REST API v1 接口，允许第三方系统（如 MES, WMS）访问生产数据。

1.  **管理位置**：前往 **设置 (Settings) → API 密钥 (API Keys)**。
2.  **创建密钥**：
    *   点击 **创建 API 密钥**。
    *   输入用途名称（如 "MES 接口"）。
    *   **权限选择**：勾选需要的权限（订单读取、产品读取、报表导出等）。
3.  **安全保存**：密钥创建后**仅显示一次**。请务必立即复制并存放在安全位置。
4.  **撤销密钥**：点击密钥旁的 **撤销** 按钮可立即禁用该密钥。已撤销的密钥将自动从列表中隐藏。

---

## 外部 API 集成 (External API Integration)

*(v8.1.0 新功能)*

iProTraX 提供了一套基于 REST 架构的标准 API，方便企业内部系统集成。

### 鉴权方式
所有请求均需在 Header 中包含 `Authorization` 令牌：
- **Header**: `Authorization`
- **Value**: `Bearer YOUR_API_KEY`

### 核心接口 (v1)
- `POST /api/v1/auth/verify`: 验证密钥有效性及权限。
- `GET /api/v1/orders`: 获取当前所有工单的实时进度。
- `GET /api/v1/products`: 获取所有激活的产品线配置。
- `GET /api/v1/reports/daily`: 获取当日生产效率汇总。

### API 示例查询
使用 `curl` 查询订单数据的示例：
```bash
curl -X GET http://localhost:3000/api/v1/orders \
  -H "Authorization: Bearer YOUR_API_KEY"
```

> **注意**：API 调用遵循管理员设定的细粒度权限管控。例如，没有 `orders:read` 权限的密钥将无法通过上述命令获取数据。

---

## 通知与集成 (Notifications & Webhooks)

*(v8.1.0 新功能)*

iProTraX 可以将生产现场的关键事件通过 Webhook 实时推送到您的协作工具（如钉钉、企业微信、飞书、Telegram 等）。

### 配置指南

前往 **设置 (Settings) → 通知 (Notifications)**：

1.  **添加 Webhook**：点击右上角的 "添加 Webhook" 按钮。
2.  **选择服务商 (Provider)**：支持 13+ 种内置服务商及自定义模式。
    *   **通用** (钉钉, 企业微信, 飞书, Slack, Discord 等)：仅需输入 `Webhook URL`。
    *   **Bark (iOS)**：输入 `服务器地址`, `设备 Key`, `提示音`, `图标 URL`。
    *   **Telegram**：输入 `Bot Token` 和 `Chat ID`。
    *   **Gotify**：输入 `服务器地址` 和 `应用 Token`。
    *   **自定义 (Custom)**：配置 `Webhook URL`, `请求方法` (POST/GET), `请求头` (JSON), `消息体模板` (JSON)。
3.  **选择触发事件 (Triggers)**：
    *   **暂停报警 (Hold)**：订单暂停时的紧急通知。
    *   **质量报警 (QN)**：发生质量问题时的紧急通知。
    *   **完工通知 (Done)**：订单完成所有工序时的通知。
    *   **工序更新 (Step Update)**：实时工步进度更新（可选）。
    *   **每日晨报 (Morning Report)**：每天早上 8:00 自动发送生产日报。
    *   **有新消息 (New Message)**：当收到系统消息或被 @提及时的通知。

### 自定义 Webhook 模板变量

如果您使用 **自定义 (Custom)** 模式，可以在消息体模板中使用以下变量：
*   `{{orderId}}`: 工单号 (如 WO-1234)
*   `{{status}}`: 当前状态 (如 Hold, QN)
*   `{{step}}`: 当前工序
*   `{{productName}}`: 产品线名称
*   `{{sender}}`: 发送者姓名 (仅限消息事件)
*   `{{message}}`: 消息内容

---

## 用户角色与权限

| 角色 | 权限 |
|------|------|
| **用户** | 查看订单，在操作视图中更新状态 |
| **看板 (Kiosk)** | 仅限查看电子看板，30天长效登录，无法访问后台 |
| **主管** | 所有用户权限 + 导入订单、批量操作、管理普通用户 |
| **管理员** | 所有权限 + 设置、用户管理、数据管理 |

---

## 许可与免费版 (License & Free Tier)

iProTraX 采用安全的许可证密钥系统。

### 许可证类型

- **免费版 / 试用版 (Free Tier / Trial)**：如果没有提供许可证密钥或许可证已过期，系统将自动激活此模式。
- **专业版 (Pro)**：解锁更多产品线和用户数。
- **企业版 (Enterprise)**：为大型组织定制的限制。

### 免费版限制

如果您处于免费版模式：
1.  **产品线**：限制为 **1 条产品线**。
2.  **用户数**：限制为 **10 个用户**。
3.  **时间限制**：**无**。您可以永久免费使用。

> **注意**：如果您超过了用户限制，新用户注册将被阻止，直到您升级许可证或删除不活跃的用户。

---

## 常见问题

### 常见问题解答

**问：页面一直刷新**
- 清除浏览器缓存和 Cookie
- 尝试使用其他浏览器
- 联系管理员重启服务器

**问：无法登录**
- 检查用户名和密码
- 确保您的账户已获批准
- 联系管理员

**问：订单不显示**
- 选择正确的产品线
- 检查是否启用了"显示已完成"
- 刷新页面

**问：AI 没有响应**
- 在设置中验证 OpenAI API 密钥是否已配置
- 检查您的 API 密钥余额/配额

---

## 技术支持

如需技术支持，请联系您的系统管理员。

**iProTraX v8.2.0** - AI 驱动的生产跟踪器
